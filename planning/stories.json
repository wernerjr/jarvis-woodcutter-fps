{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "project": "jarvis-woodcutter-fps",
  "updatedAt": "2026-02-18T16:14:00Z",
  "statusLegend": {
    "epic": ["todo", "doing", "done"],
    "story": ["todo", "doing", "done"]
  },
  "epics": [
    {
      "id": "P11",
      "title": "Conta Vinculada (upgrade do guest)",
      "status": "todo",
      "objective": "Permitir que jogador guest vincule sua conta a um identificador persistente (e-mail + código mágico), mantendo progresso e habilitando login seguro em múltiplos dispositivos.",
      "successMetrics": [
        "Taxa de conversão guest -> conta vinculada",
        "Queda em relatos de perda de progresso",
        "Aumento de retenção D7 de jogadores vinculados"
      ],
      "stories": [
        {
          "id": "P11-S1",
          "title": "Modelo de dados para account vinculada e vínculo com guest existente",
          "status": "todo",
          "objective": "Adicionar entidades/tabelas para conta persistente e relação de migração de progresso do guest para accountId.",
          "acceptanceCriteria": [
            "Schema possui entidade de account com identificador único (e-mail normalizado).",
            "Guest pode ser associado a accountId sem perder progresso já salvo.",
            "Migração é idempotente (repetir operação não duplica nem corrompe dados).",
            "Logs mínimos de auditoria para vínculo concluído."
          ],
          "probableFiles": [
            "apps/server/src/db/schema.ts",
            "apps/server/drizzle/*",
            "apps/server/src/services/*"
          ],
          "testPlan": [
            "Criar guest com progresso, vincular conta e validar manutenção do estado.",
            "Executar vínculo duas vezes e confirmar idempotência.",
            "Validar conflitos com e-mail já existente."
          ],
          "mvp": true,
          "updatedAt": "2026-02-18T16:14:00Z"
        },
        {
          "id": "P11-S2",
          "title": "Fluxo backend: solicitar código mágico e confirmar vínculo",
          "status": "todo",
          "objective": "Expor endpoints para iniciar vínculo por e-mail (geração/envio de código) e confirmar código para converter guest em conta vinculada.",
          "acceptanceCriteria": [
            "Endpoint para solicitar código mágico com rate limit por IP/e-mail.",
            "Código tem TTL curto e uso único.",
            "Endpoint de confirmação valida código e conclui vínculo guest -> accountId.",
            "Retorno inclui token/sessão válida para uso subsequente no jogo."
          ],
          "probableFiles": [
            "apps/server/src/routes/auth*",
            "apps/server/src/services/auth*",
            "apps/server/src/ws/*"
          ],
          "testPlan": [
            "Solicitar e confirmar código válido dentro do TTL.",
            "Tentar código expirado e reutilização do mesmo código.",
            "Validar proteção básica contra brute-force."
          ],
          "mvp": true,
          "updatedAt": "2026-02-18T16:14:00Z"
        },
        {
          "id": "P11-S3",
          "title": "UI do client: 'Salvar meu progresso' e login por código",
          "status": "todo",
          "objective": "Adicionar fluxo simples no client para solicitar vínculo por e-mail, inserir código e concluir login persistente.",
          "acceptanceCriteria": [
            "Ação visível no inventário/menu: 'Salvar meu progresso'.",
            "Tela/modal com campo de e-mail e campo de código.",
            "Feedback claro de sucesso/erro/expiração.",
            "Após concluir, sessão segue autenticada e progresso permanece intacto."
          ],
          "probableFiles": [
            "apps/client/src/game/UI.js",
            "apps/client/src/net/*",
            "apps/client/src/game/Game.js"
          ],
          "testPlan": [
            "Fluxo feliz completo no client.",
            "Erro de código inválido/expirado com retry.",
            "Reabrir jogo após vínculo e confirmar persistência/login."
          ],
          "mvp": true,
          "updatedAt": "2026-02-18T16:14:00Z"
        }
      ],
      "updatedAt": "2026-02-18T16:14:00Z"
    }
  ]
}
